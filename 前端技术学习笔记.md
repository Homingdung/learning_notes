[toc]
# JavaScript



# JavaScript Dom 



## 什么是 DOM 

+ Document Object Model 文本对象模型
+ Object Oriented Representation



## onclick

> 介绍 onclick 的两种写法
>
> 点击 button 会出现 Clicked！效果

方法一：

```html
// html
<button id="btn">Click here</button>
```



```js
// javascript
btn.onclick =()=>{
  console.log("Clicked!");
};
```



方法二：

```html
// html
<button id="btn" onclick="clickButton()">Click here</button>
```



```js
//javascript
const clickButton=()=>{
  console.log("Clicked1");

};
```



## addEventListener

```html
// html
<h1 id="heading">Hi there</h1>
<h3 id="heading">Test</h3>
<button id="btn">Click here</button>
```

```js
// javascript
const heading = document.getElementById("heading");
btn.addEventListener("click", () => {
    heading.style.cssText = "background-color:brown;color:white";
});

//查看properties
const heading = document.getElementById("heading");
btn.addEventListener("click", (e) => {
  console.log(e);//e.property
});
```

## parentElement &parentNode

```html
<div class="wrapper">
  <ul class="list">
    <li>Home</li>
    <li id="list-item">About</li>
    <li>Contact</li>
  </ul>
</div>
```



```js
const listItem = document.getElementById("list-item");
console.log(listItem.parentElement);
console.log(listItem.parentNode.parentNode);
// 
const list = document.querySelector(".list");
console.log(list.childNodes);
console.log(list.children);
console.log(list.firstChild);
console.log(list.firstElementChild);
//
console.log(listItem.nextElementsSibling);

```



```html
//console 会出现
<ul class="list">
    <li>Home</li>
    <li id="list-item">About</li>
    <li>Contact</li>
</ul>
//和
<div class="wrapper">
  <ul class="list">
    <li>Home</li>
    <li id="list-item">About</li>
    <li>Contact</li>
  </ul>
</div>

```



## creatElement & createTextNode & appendChild & insertBefore



```html
// html
<div class="wrapper">
  <ul class="list">
    <li>Home</li>
    <li id="list-item">About</li>
    <li>Contact</li>
  </ul>
</div>
```



```js
//javascript
const list = document.querySelector(".list");
const newE1 = document.createElement("li");
const text = document.createTextNode("Blog");

newE1.appendChild(text);
console.log(newE1);

list.appendChild(newE1);
list.insertBefore(newE1, list.children[0]);
list.removeChild(newE1);
console.log(list);
```







# Ajax

## 什么是Ajax

+ AJAX = Asynchronous JavaScript and XML（异步的 JavaScript 和 XML）
+ AJAX 不是新的编程语言，而是一种使用现有标准的新方法
+ AJAX 是与服务器交换数据并更新部分网页的艺术，在不重新加载整个页面的情况下
+ AJAX 是一种在无需重新加载整个网页的情况下，能够更新部分网页的技术。





## 同步请求和异步请求

同步：一步接一步

异步：非阻塞，异步逻辑和主逻辑相互独立，主逻辑不需要等待异步逻辑完成，而是可以继续下去。

XMLHttpRequest 

Example 1:

```javascript
console.log("a")
console.log("b")
console.log("c")
setTimeout(()=>{console.log("我的饭卡拿到了！")}，2000) //异步操作
console.log("d")
console.log("e")
```

Example 2:

```javascript
console.log(1)
$ajax({
  type:"get",
  url:"http:///////",
  success:function (response){ //异步操作 1
    console.log(response)
  }
});

$ajax({
  type:"get",
  url:"http:///////",
  success:function (response){ //异步操作 2 // 谁先返回先执行谁
    console.log(response)
  }
});
console.log(2)


```

## promise

异步编程的一种解决方案，比传统解决方案-回调函数和事件-更合理而且更强大

有三个状态：

1. pending [待定] 初始状态
2. fufilled [实现] 操作成功
3. rejected [拒绝] 操作失败

```javascript
var promise = new Promise(传一个函数)
var promise = new Promise(function(resolve,reject){
  resolve('abc');//状态一旦变化实行promise.then
});
promise.then(function(res){
  console.log(res)  //成功
}).catch((err)=>{ //失败 
  console.log(err)
});
                          
  

```

### Promise.all

可以将多个promise实例包装成一个新的promise实例。同时成功和失败的返回值是不同的，成功的时候返回的是一个结果数组，失败的时候返回最先被reject失败状态的值

```javascript
let p1 = new Promise((resolve,reject)=>{
  resolve('成功了')
})
let p2 = new Promise((resolve,reject)=>{
  resolve('success')
})
let p3 = Promise.reject('失败')

Promise.all([p1,p2]).then((result)=>{
  console.log(result) //["成功了"，"success"]
}).catch((error)=>{
  console.log(error)
})

Promise.all([p1,p3,p2]).then((result)=>{
  console.log(result)
}).catch((error)=>{
  console.log(error) //失败了，打出"失败"
})
```

### Promise.race

Promise.race([p1,p2,p3])里面哪个结果获得的快，就返回哪个结果，不管结果本身是成功还是失败

```javascript
let p1 = new Promise((resolve,reject)=>{
  setTimeout(()=>{
    resolve('success')
  },1000)
})

let p2 = new Promise((resolve,reject)=>{
  setTimeout(()=>{
    reject('failed')
  },500)
})

Promise.race([p1,p2]).then((result)=>{
  console.log(result)
}).catch((error)=>{
  console.log(error) 
})
```



### Async/await

处理异步，Generator函数的改进，背后的原理是 promise

```javascript
consolo.log(1)
async function f1(){
  return "abc" //return Promise.resolve('abc');
  //return new Promise((resolve)=>{resolve('abc')});
  //自动包装成promise对象
  //与下面两种等价
  //return Promise.resolve('abc');
  //return new Promise((resolve)=>{resolve('abc')});
}
console.log(f1())


```

与Await结合

```javascript
async function f3(){
  return 'f3';
}
function f4(){
  return 'f4';
}

async function f5(){
  var c=await f3(); //等待 f3 //await 会阻塞后面的代码，等待主程序执行完，再回来执行
  console.log(c);
}
```









## Ajax代码编写的步骤



1.创建XMLHttpRequest 对象

~~~javascript
var xmlhttp;
function ajax_demo(){
  //1.
  if (window.XmlHttpRequest){
    xmlhttp = new XmlHttpRequest();
  }else{
    xmlhttp = new ActiveXobject("Microsoft.XMLHTTP");
  }
}
~~~

2.注册回调函数

~~~javascript
var xmlhttp;
function ajax_demo(){
  //1.
  if (window.XmlHttpRequest){
    xmlhttp = new XmlHttpRequest();
  }else{
    xmlhttp = new ActiveXobject("Microsoft.XMLHTTP");
  }
    xmlhttp.onreadystatechance = function(){
    //执行异步代码逻辑
  }
}
~~~







3.建立与服务端的连接

~~~javascript
var xmlhttp;function ajax_demo(){  
  //1.  
  if (window.XmlHttpRequest){   
    xmlhttp = new XmlHttpRequest(); 
  }else{ 
    xmlhttp = new ActiveXobject("Microsoft.XMLHTTP");
  }  xmlhttp.onreadystatechance = function(){   
    //执行异步代码逻辑 
  }
  xmlhttp.open("POST|GET","目标URL",true|false);//true 异步 ,false 同步
}

~~~





4.发送请求

~~~javascript
var xmlhttp;function ajax_demo(){  
  //1.  
  if (window.XmlHttpRequest){   
    xmlhttp = new XmlHttpRequest(); 
  }else{ 
    xmlhttp = new ActiveXobject("Microsoft.XMLHTTP");
  }  xmlhttp.onreadystatechance = function(){   
    //执行异步代码逻辑 
    //..步骤
    //..当readState值变为4，我们才有兴趣去处理，其他情况不关心
    if (xmlhttp.readState==4){
      if (xmlhttp.status==200){
        //表示服务端正常响应客户端
        ...
        var str = xmlhttp.responseText;
        //如果服务端传过来的是json字符串，则用 var json=JSON.parse(str)解析成JSON对象;
        ...
       
      }
      //....
    }
    //..
    
  }
  xmlhttp.open("POST|GET","目标URL",true|false);//true 异步 ,false 同步
  xmlhttp.send();//如果要传递数据给服务端，把数据作为参数传过去
}

~~~



## XMLHttpRequest 对象的属性

1.readState 属性

> 此属性0-4的值，共计5种状态
>
> 0 请求未初始化
>
> 1 服务器连接已经建立
>
> 2 请求已结束
>
> 3 请求处理中
>
> 4 **请求已经完成，响应已就绪**

2.status 属性



> 响应的状态码，五种类型值
>
> 1xx..
>
> 2xx**代表服务端正常响应客户端**
>
> 3xx代表服务端资源没有发生改变
>
> 4xx代表资源错误
>
> 5xx代表服务端错误



3.responseText和responseXML

>responseText 表示以**文本**的信息获取服务端的响应，获取的就是字符串 JSON.parse() JSON.stringify()
>
>responseXML 当服务端以**XML**格式返回给客户端，则使用此属性去接收，获取的就是DOM对象



# XHR

## 什么是XHR

+ XMLHttpRequest 是 AJAX 的基础
+ XMLHttpRequest 术语缩写为XHR，中文可以解释为可扩展超文本传输请求
+ XMLHttpRequest 对象可以在不向服务器提交整个页面的情况下，实现局部更新网页
+ XMLHttpRequest的对象用于客户端和服务器之间的异步通信。

## 作用

　它执行以下操作：

+ 在后台从客户端发送数据
+ 从服务器接收数据
+ 更新网页而不重新加载。

## 创建 XMLHttpRequest 对象

```js
variable = new XMLHttpRequest();
```

### XMLHttpRequest 属性和方法

```javascript
//XHR属性
onreadystatechange //存储函数（或函数名），每当readyState的属性改变时，就会调用该函数
readyState //存有的XMLHttpRequest的状态从0到4发生变化。
							//0：请求未初始化 
							//1：服务器连接已建立 
							//2：请求已接收 
							//3：请求处理中 
							//4：请求已完成，且响应已就绪 
responseText //以文本形式返回响应
responseXML //以XML格式返回响应
status      //将状态返回为数字（例如，“Not Found”为404，“OK”为200）
statusText  //以字符串形式返回状态（例如，“Not Found”或“OK”）

//XHR方法
abort() //取消当前请求
getAllResponseHeaders() //以字符串形式返回完整的HTTP标头集
getResponseHeader( headerName ) //返回指定HTTP标头的值
void open（method，URL）//打开指定获取或交的方法和URL的请求
void open（method，URL，async）//与上面相同，但指定异步或不
void open（method，URL，async，userName，password）//与上面相同，但指定用户名和密码
void send（content）//发送获取请求
setRequestHeader（ label，value）//将标签/值对添加到要发送的HTTP标头



```



## XHR请求

![截屏2020-07-02 18.29.20](/Users/peter/Desktop/截屏2020-07-02 18.29.20.png)



1. 用户从UI发送请求，JavaScript中调用XMLHttpRequest对象。
2. HTTP请求由XMLHttpRequest对象发送到服务器。
3. **服务器使用JSP，PHP，Servlet，ASP.net等与数据库交互**
4. 检索数据。
5. 服务器将XML数据或JSON数据发送到XMLHttpRequest回调函数。
6. HTML和CSS数据显示在浏览器上。

### 发送请求

```js
//将请求发送到服务器
xmlhttp.open("GET","ajax_info.txt",true);        
xmlhttp.send();

//方法
open(method,url,async) //规定请求的类型、URL 以及是否异步处理请求。
											 //method：请求的类型；GET 或 POST
											 //url：文件在服务器上的位置
											 //async：true（异步）或 false（同步）

send(string) 		//将请求发送到服务器  string：仅用于 POST 请求
```

## XHR响应

- **状态行** 
  `xhr.status`状态码，如200，304，404等； 
- **响应主体** 
  `xhr.responseText`与`xhr.responseXML`都表示响应主体。 

### responseText 属性

+ 如果来自服务器的响应并非 XML，请使用`responseText`属性
+ 对于`responseText`属性，只有当readyState属性值变为4时，`responseText`属性才可用，因为这表明AJAX请求已经结束！

### responseXML 属性

+ 如果来自服务器的响应是 XML，而且需要作为 XML 对象进行解析，请使用`responseXML`属性

### Example

> 加载奥特曼效果



```html
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="./pro630.css">
    <title></title>
</head>

<body>
    <div class="head">
        <p class="allLink">AllLink</p>
    </div>
    <div class="bottom"></div>
    <div class="loading">Loading</div>
    <div id="image"></div> 




    <script src="pro630.js"></script>
</body>

</html>
```

```css
// CSS 样式
.head {
    background-color: rgba(248, 248, 248, 0.5);
    width: 100vw;
    height: 200px;
    border-width: 1px;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
}

.allLink {
    font-size: xx-large;
    position: fixed;
    left: 200px;
    top: 50px;
}

.bottom {
    background-color: rgb(248, 248, 248, 0.5);
    width: 100vw;
    height: 200px;
    border-width: 1px;
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
}

.loading {
    text-align: center;
    font-size: xx-large;
    font-style: normal;
    font-weight: 800;
    top: 50%;
    left: 50%;
    margin: 0;
    position: fixed;
    color: black;
    display: block;
}

.img {
    height: 100%;
    width: 100%;
}

#image {
    display: flex;
    flex-direction: row;
    flex-wrap: wrap;
    justify-content: space-between;
}

#image div {
    width: 35vw;
    height: 35vh;
    margin: 50px;
}

#outman {
    position: relative;
    width: 100%;
    top: 10px;
    text-align: left;
    color: black;
    font-size: medium;
}
```



```js
// 选择所需变量
var image = document.getElementById("image");
var superhero = [];

var XHR = new XMLHttpRequest();
XHR.onreadystatechange = function() {
    if (XHR.readyState == 4) {
        if (XHR.status == 200) { //服务器正常响应客户端

            superhero = JSON.parse(XHR.responseText); //解析
        }
        for (var i in superhero) {
            var link = superhero[i];
            var superheroadd = document.createElement("div");
            superheroadd.innerHTML = "<img class='img' src=" + link + ">" +
                "<p class=" + "outman" + ">" + i + "</p>"
            image.appendChild(superheroadd);
        }
        document.getElementsByClassName("loading")[0].style.display = "none";
    }
}
XHR.open("GET", "server.php", "true") // 异步
XHR.send();
```






# JSON

## What is JSON

+ Javascript Object Notation
+ Data representation format

+ Based on a subset of Javascript

+ Often used with AJAX
+ Lightweigtht and Easy to Read /Write
+ Intergrates Easily with most languages



## DataTypes

+ number
+ String
+ Boolean
+ Array
+ ***Object***
+ Null



## JSON Syntax Rules

+ Uses key/value pairs
+ ***Uses double quotes around KEY and VALUE***
+ Must use the specified data types
+ File type is ".json"
+ MIME type is "Application/json"

```json
/*Json*/
{
  "name":"Brad Traversy",
  "age":35,
  "address":{
    "street":"5 main st",
    "city":"Boston"
  },
  "children":["Brianna","Nicholas"],
  "friends":[{
    "name":"Joey",
    "favoriteNumber":100,
    "isProgrammer":flase,
    "friends":[...]
  }]
  
}
```



## Example

```html
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title></title>
</head>

<body>
    <button id="button"></button>
    <script src="main.js"></script>

</body>

</html>
```



```javascript
//main.js
let companies = [{
        "name": "Big Corporation",
        "numberOfEmployees": 100,
        "ceo": "Mary",
        "rating": 3.6
    },
    {
        "name": "Small startup",
        "numberOfEmployees": 3,
        "ceo": null,
        "rating": 4.3
    }
]
console.log(companies) //JSON.parse 转换成JS
```

# ES 6

## let 和 const

let:

+ let`声明的变量只在它所在的`代码块`有效
+ let 不存在变量提升，它所声明的变量一定要在声明后使用，否则报错
+ 暂时性死区只要块级作用域内存在 let 命令，它所声明的变量就“ 绑定”`（binding）`这个区域，不再受外部的影响
+ 不允许重复声明
+ let实际为js 新增了块级作用域

const:

+ const 声明一个只读的常量，一旦声明，常量的值就不能改变

顶层对象属性：

+ 顶层对象，在浏览器环境指的是window对象，在Node 指的是global对象。ES5之中，顶层对象的属性与全局变量是等价的。

ES6 为了改变这一点，一方面规定，为了保持兼容性，var命令和function命令声明的全局变量，依旧是顶层对象的属性；另一方面规定，let命令、const命令、class命令声明的全局变量，不属于顶层对象的属性。也就是说，从 ES6 开始，全局变量将逐步与顶层对象的属性脱钩：

## 解构赋值

ES6 允许按照一定模式，从数组和对象中提取值，对变量进行赋值，这被称为解构（Destructuring）

+ 模式匹配
+ 不完全解构

## 箭头函数

+ 如果只有一个参数，（）可以省
+ 如果只有一个return，{} 可以省

```js
let show=()=>{
  alert('abc');
}
```



## 面向对象

+ class 关键字，构造器和类分开了

+ class里面直接加方法

```js
class User {
    constructor(name, pass) {
        this.name = name;
        this.pass = pass;

    }
    showName() {
        alert(this.name);

    }
    showPass() {
        alert(this.pass);
    }
}

```

继承:

## Promise

消除异步操作：

+ 用同步的方式写异步代码

promise：

```js
let p=new Promise(function(resolve, reject){ //两个参数
  //resolve 成功
  //reject 失败
});
```



```js
let p = new Promise(function(resolve, reject) {
    // resolve 成功
    // reject 失败
    $.ajax({
        url: '',
        dataType: 'json',
        success(arr) {
            resolve(arr);

        },
        error(err) {
            reject(err);
        }


    });
    p.then(function() {
        alert("成功了");
    }, function() {
        alert("失败了");
    }); //p.then 中两个函数


});
```



两个promise

```js
let p = new Promise(function(resolve, reject) {
    // resolve 成功
    // reject 失败
    $.ajax({
        url: './data.txt',
        dataType: 'json',
        success(arr) {
            resolve(arr);

        },
        error(err) {
            reject(err);
        }


    })


});
let p = new Promise(function(resolve, reject) {
    // resolve 成功
    // reject 失败
    $.ajax({
        url: './data.txt',
        dataType: 'json',
        success(arr) {
            resolve(arr);

        },
        error(err) {
            reject(err);
        }


    })


});

Promise.all([ //是一个数组
    p1, p2
]).then(function() { //then 里两个函数
    alert("全都成功了")
}, function() {
    alert("至少有一个失败了");
});
```





  







 # 微信小程序开发文档

## 小程序代码构成

1. .json` 后缀的 `JSON 配置文件 
2. `.wxml` 后缀的 `WXML` 模板文件
3. `.wxss` 后缀的 `WXSS` 样式文件
4. `.js` 后缀的 `JS` 脚本逻辑文件

### JSON 配置

我们可以看到在项目的根目录有一个 `app.json` 和 `project.config.json`，此外在 `pages/logs` 目录下还有一个 logs.json

#### 小程序配置 app.json

`app.json` 是当前小程序的全局配置，包括了小程序的所有页面路径、界面表现、网络超时时间、底部 tab 等

```json
//QuickStart 项目里边的 `app.json` 配置内容如下：
{
  "pages":[
    "pages/index/index",
    "pages/logs/logs"
  ],										//于描述当前小程序所有页面路径，这是为了让微信客户端知道当前你的小程序页面定义在哪个目录
  "window":{
    "backgroundTextStyle":"light",
    "navigationBarBackgroundColor": "#fff",
    "navigationBarTitleText": "WeChat",
    "navigationBarTextStyle":"black" // 定义小程序所有页面的顶部背景颜色，文字颜色定义等
  }
}
```



#### 工具配置 project.config.json

通常大家在使用一个工具的时候，都会针对各自喜好做一些个性化配置，例如界面颜色、编译配置等等，当你换了另外一台电脑重新安装工具的时候，你还要重新配置。

考虑到这点，小程序开发者工具在每个项目的根目录都会生成一个 `project.config.json`，你在工具上做的任何配置都会写入到这个文件，当你重新安装工具或者换电脑工作时，你只要载入同一个项目的代码包，开发者工具就自动会帮你恢复到当时你开发项目时的个性化配置，其中会包括编辑器的颜色、代码上传时自动压缩等等一系列选项



#### 页面配置 page.json

这里的 `page.json` 其实用来表示 pages/logs 目录下的 `logs.json` 这类和小程序页面相关的配置。

如果你整个小程序的风格是蓝色调，那么你可以在 `app.json` 里边声明顶部颜色是蓝色即可。实际情况可能不是这样，可能你小程序里边的每个页面都有不一样的色调来区分不同功能模块，因此我们提供了 `page.json`，让开发者可以独立定义每个页面的一些属性，例如刚刚说的顶部颜色、是否允许下拉刷新等等。



#### 小程序 JSON 语法

这里说一下小程序里JSON配置的一些注意事项。

JSON文件都是被包裹在一个大括号中 {}，通过key-value的方式来表达数据。JSON的Key必须包裹在一个***双引号***中，在实践中，编写 JSON 的时候，忘了给 Key 值加双引号或者是把双引号写成单引号是常见错误。

JSON的值只能是以下几种数据格式，其他任何格式都会触发报错，例如 JavaScript 中的 undefined。

1. 数字，包含浮点数和整数
2. 字符串，需要包裹在双引号中
3. Bool值，true 或者 false
4. 数组，需要包裹在方括号中 []
5. 对象，需要包裹在大括号中 {}
6. Null

还需要注意的是 JSON 文件中***无法使用注释***，试图添加注释将会引发报错。

### WXML 模板

> 网页编程采用的是 HTML + CSS + JS 这样的组合，其中 `HTML` 是用来**描述当前这个页面的结构**，CSS 用来**描述页面的样子**，`JS` 通常是用来处理这个**页面和用户的交互**。

同样道理，在小程序中也有同样的角色，其中 `WXML` 充当的就是类似 `HTML` 的角色

**Example**:

```HTML
<view class="container">
  <view class="userinfo">
    <button wx:if="{{!hasUserInfo && canIUse}}"> 获取头像昵称 </button>
    <block wx:else>
      <image src="{{userInfo.avatarUrl}}" background-size="cover"></image>
      <text class="userinfo-nickname">{{userInfo.nickName}}</text>
    </block>
  </view>
  <view class="usermotto">
    <text class="user-motto">{{motto}}</text>
  </view>
</view>
```

### WXSS 样式

`WXSS` 具有 `CSS` 大部分的特性，小程序在 `WXSS` 也做了一些扩充和修改。

+ 新增了尺寸单位。在写 `CSS` 样式时，开发者需要考虑到手机设备的屏幕会有不同的宽度和设备像素比，采用一些技巧来换算一些像素单位。`WXSS` 在底层支持新的尺寸单位 **rpx**，开发者可以免去换算的烦恼，只要交给小程序底层来换算即可，由于换算采用的浮点数运算，所以运算结果会和预期结果有一点点偏差。
+ 提供了全局的样式和局部样式。和前边 `app.json`, `page.json` 的概念相同，你可以写一个 `app.wxss` 作为全局样式，会作用于当前小程序的所有页面，局部页面样式 `page.wxss` 仅对当前页面生效。
+ 此外 `WXSS` 仅支持部分 `CSS` 选择器



### JS 逻辑交互

```html
<view>{{ msg }}</view>
<button bindtap="clickMe">点击我</button>
```

点击 `button` 按钮的时候，我们希望把界面上 `msg` 显示成 `"Hello World"`，于是我们在 `button` 上声明一个属性: `bindtap` ，在 JS 文件里边声明了 `clickMe` 方法来响应这次点击操作

```js
Page({
  clickMe: function() {
    this.setData({ msg: "Hello World" })
  }
})
```



## 小程序宿主环境

### 渲染层和逻辑层

小程序的运行环境分成渲染层和逻辑层 

+ WXML 模板和 WXSS 样式工作在**渲染层**
+ JS 脚本工作在**逻辑层**



![截屏2020-07-03 13.24.18](/Users/peter/Desktop/截屏2020-07-03 13.24.18.png)



小程序的渲染层和逻辑层分别由2个线程管理：渲染层的界面使用了WebView 进行渲染；逻辑层采用JsCore线程运行JS脚本。一个小程序存在多个界面，所以渲染层存在多个WebView线程，这两个线程的通信会经由微信客户端（下文中也会采用Native来代指微信客户端）做中转，逻辑层发送网络请求也经由Native转发



### 程序与页面

微信客户端在打开小程序之前，会把整个小程序的代码包下载到本地

紧接着通过 `app.json` 的 `pages` 字段就可以知道你当前小程序的所有页面路径

```json
// 这个配置说明在 QuickStart 项目定义了两个页面，分别位于 pages/index/index 和 pages/logs/logs
// 而写在 pages 字段的第一个页面就是这个小程序的首页（打开小程序看到的第一个页面）
{
  "pages":[
    "pages/index/index",
    "pages/logs/logs"
  ]
}
```



于是微信客户端就把首页的代码装载进来，通过小程序底层的一些机制，就可以渲染出这个首页。

小程序启动之后，在 `app.js` 定义的 `App` 实例的 `onLaunch` 回调会被执行:

```js
App({
  onLaunch: function () {
    // 小程序启动之后 触发
  }
})
```



你可以观察到 `pages/logs/logs` 下其实是包括了4种文件的，微信客户端会先根据 `logs.json` 配置生成一个界面，顶部的颜色和文字你都可以在这个 `json` 文件里边定义好。紧接着客户端就会装载这个页面的 `WXML` 结构和 `WXSS` 样式。最后客户端会装载 `logs.js`，你可以看到 `logs.js` 的大体内容就是:



```js
Page({
  data: { // 参与页面渲染的数据
    logs: []
  },
  onLoad: function () {
    // 页面渲染后 执行
  }
})
```

Page` 是一个页面构造器，这个构造器就生成了一个页面。在生成页面的时候，小程序框架会把 `data` 数据和 `index.wxml 一起渲染出最终的结构，于是就得到了你看到的小程序的样子。

在渲染完界面之后，页面实例就会收到一个 `onLoad` 的回调，你可以在这个回调处理你的逻辑。



### 组件

>小程序提供了丰富的基础组件给开发者，开发者可以像搭积木一样，组合各种组件拼合成自己的小程序。

就像 `HTML` 的 `div`, `p` 等标签一样，在小程序里边，你只需要在 `WXML` 写上对应的组件标签名字就可以把该组件显示在界面上，例如，你需要在界面上显示地图，你只需要这样写即可：

```html
<map longitude="广州经度" latitude="广州纬度"></map>
```

组件的内部行为也会通过事件的形式让开发者可以感知，例如用户点击了地图上的某个标记，你可以在 `js` 编写 `markertap` 函数来处理：

```html
<map bindmarkertap="markertap" longitude="广州经度" latitude="广州纬度"></map>
```

#### WXML 标签说明

| 标签名 |      |      |
| :----- | ---- | ---- |
| View   |      |      |



 

｜视图容器(View Container) ｜	二、基础内容(Basic Content)｜ 
标签名	说明	标签名	说明
view	视图容器	icon	 图标
scroll-view	可滚动视图容器	text	文字
swiper	可滑动的视图容器	progress	进度条
三、表单组件(Form)	四、操作反馈组件(Interaction)
标签名	说明	标签名	说明
button	按钮	action-sheet	上拉菜单
form	表单	modal	模态弹窗
input	输入框	progress	进度条
checkbox	多项选择器	toast	短通知
radio	单项选择器	五、导航(Navigation)
picker	列表选择器	组件名	说明
slider	滑动选择器	navigator	应用内跳转
switch	开关选择器
label	标签
六、多媒体(Media)	七、地图(Map)
标签名	说明	标签名	说明
audio	音频	map	地图
image	图片
video	视频
八、画布(Canvas)
标签名	说明
canvas	画布





### API

为了让开发者可以很方便的调起微信提供的能力，例如获取用户信息、微信支付等等，小程序提供了很多 API 给开发者去使用。

要获取用户的地理位置时，只需要：

```js
wx.getLocation({
  type: 'wgs84',
  success: (res) => {
    var latitude = res.latitude // 纬度
    var longitude = res.longitude // 经度
  }
})
```

调用微信扫一扫能力，只需要：

```js
wx.scanCode({
  success: (res) => {
    console.log(res)
  }
})
```

git



```
peter@peterdeMacBook-Pro:~ ls
6000519.csv			bin
Applications			brew_install
Desktop				eclipse
Documents			eclipse-workspace
Downloads			example.tre
Library				fibRec.m
Movies				jobui
Music				leafcutter
Nutstore Files			matlab_crash_dump.259-1
Pictures			matlab_crash_dump.52572-1
Public				matlab_crash_dump.63843-1
PycharmProjects			matlab_crash_dump.63944-1
README.md			matlab_crash_dump.68311-1
Rplot.png			matlab_crash_dump.82819-1
Zotero				rstanarm
a.py				trywhile.m
alllink-plus			未命名-1.tex
alllink-study			语言分析.sav
alllinks			语言分析.spv
alllinks-server			语言分析2.spv
----------------------------------------------------------------------- 18:47:50
peter@peterdeMacBook-Pro:~ ··
----------------------------------------------------------------------- 18:47:54
peter@peterdeMacBook-Pro:~/alllinks[master*] ls
app.js			dist			sitemap.json
app.json		imges			utils
app.wxss		pages
cloudfunction		project.config.json
----------------------------------------------------------------------- 18:47:54
peter@peterdeMacBook-Pro:~/alllinks[master*] git branch
* master
----------------------------------------------------------------------- 18:48:07
peter@peterdeMacBook-Pro:~/alllinks[master*] git branch refresh
----------------------------------------------------------------------- 18:48:14
peter@peterdeMacBook-Pro:~/alllinks[master*] git checkout refresh
M	.DS_Store
M	pages/.DS_Store
M	pages/detail/detail.js
M	pages/detail/detail.json
M	pages/detail/detail.wxml
M	pages/detail/detail.wxss
M	pages/mycomment/mycomment.js
M	pages/mycomment/mycomment.wxml
M	pages/mycomment/mycomment.wxss
M	pages/mylike/mylike.js
M	pages/mylike/mylike.wxml
M	pages/mylike/mylike.wxss
M	project.config.json
Switched to branch 'refresh'
----------------------------------------------------------------------- 18:48:24
peter@peterdeMacBook-Pro:~/alllinks[refresh*] git pull origin refresh
remote: Enumerating objects: 262, done.
remote: Counting objects: 100% (262/262), done.
remote: Compressing objects: 100% (116/116), done.
remote: Total 788 (delta 193), reused 189 (delta 146), pack-reused 526
Receiving objects: 100% (788/788), 1.19 MiB | 3.42 MiB/s, done.
Resolving deltas: 100% (460/460), completed with 6 local objects.
From https://gitlab.com/unnc-fse-20126609/alllinks
 * branch            refresh    -> FETCH_HEAD
   7def54f..fcf90c1  refresh    -> origin/refresh
Updating 7def54f..fcf90c1
error: Your local changes to the following files would be overwritten by merge:
	pages/detail/detail.js
	pages/detail/detail.json
	pages/detail/detail.wxml
	pages/detail/detail.wxss
Please commit your changes or stash them before you merge.
error: Your local changes to the following files would be overwritten by merge:
	.DS_Store
	pages/.DS_Store
	pages/mycomment/mycomment.js
	pages/mycomment/mycomment.wxml
	pages/mycomment/mycomment.wxss
	pages/mylike/mylike.js
	pages/mylike/mylike.wxml
	pages/mylike/mylike.wxss
	project.config.json
Please commit your changes or stash them before you merge.
Aborting
----------------------------------------------------------------------- 18:48:34
peter@peterdeMacBook-Pro:~/alllinks[refresh*] git reset --hard origin/refresh
HEAD is now at fcf90c1 奇怪的颜色
----------------------------------------------------------------------- 18:49:32
peter@peterdeMacBook-Pro:~/alllinks[refresh*] ls
app.js			dist			sitemap.json
app.json		imges			utils
app.wxss		pages
cloudfunction		project.config.json
----------------------------------------------------------------------- 18:49:49
peter@peterdeMacBook-Pro:~/alllinks[refresh*] 

git add .
git commit -m "message"
git push
git push 
git push -u origin refresh //push 到分支

```

```html
<view class="navigator">
    <text class="search_hint">游游</text>
    <button class="search" bindtap="goToSearch">
        口红、零食、教材...
    </button>
</view>
<view class="nav_page">
    <block wx:for="{{navPageItems}}" wx:key="iddd">
        <button class="{{curIndex_page+1==item.iddd ? 'active': ''}} page_items" bindtap="switchTab3" data-index="{{item.iddd-1}}">
            <text>{{item.title}}</text>
        </button>
    </block>
</view>

<!-- <swiper current="{{curIndex_page}}" data-current="{{curIndex_page}}" style="height: {{swiper_height_top}}" bindchange="switchTab_page">
    <swiper-item> -->
        <view class="page" bindtouchstart="myTouchStart" bindtouchmove="myTouchMove">
            <view class="container">
                <view class="swiperBar">
                    <swiper indicator-dots="{{indicatorDots}}" vertical="{{vertical}}" autoplay="{{autoplay}}" interval="{{interval}}" duration="{{duration}}">
                        <block wx:for-items="{{banner_url}}" wx:key="id">
                            <swiper-item>
                                <image wx:if="{{item}}" src="{{item}}" mode="aspectFill" />
                                <image wx:else src="../../imges/home/banner/d cefault_pic.png" mode="aspectFill"></image>
                            </swiper-item>
                        </block>
                    </swiper>
                </view>

                <view class="nav_top">
                    <block wx:for="{{navTopItems}}" wx:key="id">
                        <view class="nav_top_items {{curNavId==item.id ? 'active': ''}}" bindtap="switchTab" data-index="{{index}}" data-id="{{item.id}}">
                            <van-icon name="{{item.icon}}" size="45px" />
                            <text>{{item.title}}</text>
                        </view>
                    </block>
                </view>

                <!-- why use curIndex_1 _2 _3 .... -->
                <view class="nav_bottom_background">
                    <view class="nav_bottom" style="{{isFixed?'position:fixed;top:0;padding-top:10vh':''}}">
                        <block wx:for="{{navBottomItems[curIndex]}}" wx:key="idd">
                            <view id="nav_bottom" class="nav_bottom_items {{curIndex_2==item.idd ? 'active': last_section==item.idd ? 'inact' : ''}}" bindtap = "switchTab2" data-index="{{index}}">
                                <text>{{item.title}}</text>
                            </view>
                        </block>
                    </view>
                </view>
                               
                <swiper current="{{curIndex_2}}" data-current="{{curIndex_2}}" class="nav_section" bindchange="switchSection" style="height: {{swiper_height}}">
                    <block wx:for="{{navBottomItems[curIndex]}}" wx:key="idd">
                        <swiper-item item-id= "{{idd}}" >
                            <!-- 高度适配头 -->
                            <view id="start{{item.idd}}"></view>
                            <view wx:if="{{curIndex==2}}">
                            <!-- 组织块 -->
							    <view wx:if="{{item.idd>2}}">
								<view class="title">
									<image class="imgt" src="../../imges/home/icon/recommendation.png.jpg"></image>
									<text>推荐了解</text>
								</view>
                <view class="organization">
                  <view class="clubPart" wx:for="{{recommendation_club}}" bindtap="clickClub" data-id='{{index}}'>
                    <image class="imgc" src="{{item.imgc}}"></image>
                    <text class="name">{{item.text}}</text>
                  </view>
                </view>
								<view class="title">
									<image class="imgt" src="../../imges/home/icon/all.png.jpg"></image>
									<text>所有社团</text>
								</view>
                <view class="organization">
                  <view class="clubPart" wx:for="{{all_club}}" bindtap="clickClub2" data-id='{{index}}'>
                    <image class="imgc" src="{{item.imgc}}"></image>
                    <text class="name">{{item.text}}</text>
                  </view>
                </view>
                </view>
							</view>
                            <!-- 组织块结束 -->
                            <!-- 物品（闲置交易和失物招领） -->
                            <view wx:if="{{list[curIndex][item.idd]}}">
                                <view wx:if="{{curIndex<2}}" class="lists">
                                    <!-- left list -->
                                    <view class="leftlist">
                                        <block wx:for="{{list[curIndex][item.idd]}}" wx:key="_id" wx:for-index="idx"  wx:if="{{idx%2==0}}">
                                            <view  class="nav_section_items" catchtap="navigateDetail"
                                                   data-aid="{{item._id}}"
                                                   data-user="{{item.openid}}"
                                                   data-tabID="{{item.tabid}}"
                                                   data-file="{{item.fileList}}"
                                                   data-like="{{item.likeID}}"
                                                   data-wxid="{{item.wxid}}"
                                                   data-tele="{{item.tele}}"
                                                   data-title="{{item.title}}"
                                                   data-content="{{item.content}}" >
                                                <!--image-->
                                                <view class="section_image">
                                                    <block wx:if="{{item.fileList[0]}}">
                                                        <image src="{{item.fileList[0]}}" mode="widthFix"></image>
                                                    </block>
                                                    <block wx:else>
                                                        <image src="../../imges/home/banner/default_pic.png" mode="widthFix"></image>
                                                    </block>
                                                </view>
                                                <!--content-->
                                                <view class="section_cont">
                                                    {{item.title}}
                                                </view>
                                                <!--物品卡片-->
                                                <button class="new">
                                                    <image class="newicon" src="../../imges/home/icon/new.jpg"></image>
                                                    新上架
                                                </button>
                                                <button class="sold">
                                                    <image class="soldicon" src="../../imges/home/icon/sold.jpg"></image>
                                                    已卖出
                                                </button>
                                                <button class="please">
                                                    <image class="pleaseicon" src="../../imges/home/icon/please.jpg"></image>
                                                    求收走
                                                </button>
                                                <view class="user_info">
                                                    <image class="user_avatar" src="{{item.user[0].userInfo.avatarUrl}}"></image>
                                                    <text class="user_nickname">{{item.user[0].userInfo.nickName}}</text>
                                                </view>
                                            </view>
                                        </block>
                                        <view id="end{{item.idd}}l" class="endAnchor"></view>
                                    </view>
                                    <!-- right list -->
                                    <view  class="rightlist">
                                        <block wx:for="{{list[curIndex][item.idd]}}" wx:key="_idd" wx:for-index="idx"  wx:if="{{idx%2!=0}}">
                                            <view  class="nav_section_items" catchtap="navigateDetail" data-aid="{{item._id}}" data-user="{{item.openid}}" data-tabID="{{item.tabid}}"
                                                   data-file="{{item.fileList}}"navigateD
                                                   data-like="{{item.likeID}}"
                                                   data-wxid="{{item.wxid}}"
                                                   data-tele="{{item.tele}}"
                                                   data-title="{{item.title}}"
                                                   data-content="{{item.content}}" >
                                                <!--image-->
                                                <view class="section_image">
                                                    <block wx:if="{{item.fileList[0]}}">
                                                        <image src="{{item.fileList[0]}}" mode="widthFix"></image>
                                                    </block>
                                                    <block wx:else>
                                                        <image src="../../imges/home/banner/default_pic.png" mode="widthFix"></image>
                                                    </block>
                                                </view>
                                                <!--content-->
                                                <view class="section_cont">
                                                    {{item.title}}
                                                </view>
                                                <!--物品卡片-->
                                                <button class="new">
                                                    <image class="newicon" src="../../imges/home/icon/new.jpg"></image>
                                                    新上架
                                                </button>
                                                <button class="sold">
                                                    <image class="soldicon" src="../../imges/home/icon/sold.jpg"></image>
                                                    已卖出
                                                </button>
                                                <button class="please">
                                                    <image class="pleaseicon" src="../../imges/home/icon/please.jpg"></image>
                                                    求收走
                                                </button>
                                                <view class="user_info">
                                                    <image class="user_avatar" src="{{item.user[0].userInfo.avatarUrl}}"></image>
                                                    <text class="user_nickname">{{item.user[0].userInfo.nickName}}</text>
                                                </view>
                                            </view>
                                        </block>
                                        <view id="end{{item.idd}}r" class="endAnchor"></view>
                                    </view>
                                </view>
                                <!-- 活动信息 -->
                                <!-- activity -->
                                <block wx:for="{{list[curIndex][item.idd]}}" wx:key="_iddd">
                                    <view wx:if="{{curIndex>1 && curIndex_2<3}}" class="nav_section_items_else" catchtap="navigateDetail" 
                                    data-aid="{{item._id}}" 
                                    data-user="{{item.openid}}" 
                                    data-file="{{item.fileList}}"
                                    data-wxurl="{{item.wxurl}}"
                                    data-title="{{itsem.title}}"
                                    data-subtitle="{{item.subtitle}}"
                                    data-content="{{item.content}}"
                                    data-start="{{item.startTime}}"
                                    data-end="{{item.endTime}}"
                                    data-club="{{item.club}}"
                                    data-cover="{{item.coverpage}}"
                                    data-tab="2" 
                                    >
                                        <view class="nav_subitem">
                                            <!--image-->
                                            <view class="section_image_else" wx:if="{{item.coverpage}}">
                                                <image src="{{item.coverpage}}" mode="widthFix"></image>
                                            </view>
                                        </view>
                                        <!--MainTitle-->
                                        <view class="section_cont_else">
                                            {{item.title}}
                                        </view>
                                        <!--Subtitle-->
                                        <view class="section_cont_else_sub">
                                            {{item.title}}
                                        </view>
                                        <!--user-->
                                        <view class="user_info_else">
                                            <view class="user_info_detail">
                                                <view wx:if="{{curIndex==2 || !item.isanony}}">
                                                    <image class="user_avatar" src="{{item.user[0].userInfo.avatarUrl}}"></image>
                                                    <text class="user_nickname">{{item.user[0].userInfo.nickName}}</text>
                                                </view>
                                                <view wx:else>
                                                    <image class="user_avatar" src="../../imges/home/unknown.png"></image>
                                                    <text class="user_nickname">{{item.anonyname}}（匿名）</text>
                                                </view>
                                            </view>
                                            <view wx:if="{{curIndex==3}}" wx:for="{{item.topic}}" wx:key="item" class="no">
                                                <view class="topic" data-topicName="{{item}}" catchtap="toTopic" hover-class="topic_hover"> #{{item}}</view>
                                            </view>
                                        </view>
                                    </view>
                                </block>
                            </view>
                            <view id="end{{item.idd}}r" class="endAnchor"></view>
                            <view id="end{{item.idd}}l" class="endAnchor"></view>
                        </swiper-item>
                    </block>
                </swiper>
                <view class="no_more" wx:if="{{!(curIndex==2 && curIndex_2==3)}}" >
                    <view class="no_more_text">{{bottomText}}</view>
                </view>
            </view>
        </view>
    
<!-- <van-tabbar class="tabbar" active="{{active}}" bind:change="onChange">
    <van-tabbar-item name="index" icon="../../imges/home/icon/homeSelected.png" bindtouchstart="touchStart" bindtouchend="touchEnd" bindtap="scrolltoTop"></van-tabbar-item>
    <view bindtap="showActions" class="release"> <image src="../../imges/home/icon/release.png"></image></view>
    <van-action-sheet show="{{show}}" actions="{{actions}}" bind:close="onClose" bind:select="onSelect"></van-action-sheet>
    <van-tabbar-item name="me" icon="../../imges/home/icon/my.png"></van-tabbar-item>
</van-tabbar> -->

<van-tabbar class="tabbar" active="{{active}}" bind:change="onChange">
    <van-tabbar-item name="index" icon="../../imges/home/icon/homeSelected.png" data-time='{{lastTapTime}}' bindtap="scrolltoTop"></van-tabbar-item>
    <view bindtap="showActions" class="release"> <image src="../../imges/home/icon/release.png"></image></view>
    <van-action-sheet show="{{show}}" actions="{{actions}}" bind:close="onClose" bind:select="onSelect"></van-action-sheet>
    <van-tabbar-item name="me" icon="../../imges/home/icon/my.png"></van-tabbar-item>
</van-tabbar>



```

```css
//bbs css
.search {
  float: left;
  margin-left: 10rpx;
  font-size: 28rpx;
  width: 390rpx;
  text-align: left;
  border-radius: 18rpx;
  align-items: center;
  color: #999999;
  background-color: rgb(252,251,250,0.75);
  height: 60rpx;
  line-height: 30px;
  margin-top: 30rpx;
}
```

